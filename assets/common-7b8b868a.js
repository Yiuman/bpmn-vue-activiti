import{d as N,r as k,g as h,o as T,w as $,c as r,h as w,m as x,i as F,t as C,j as y,b as d,a as c,k as g,B as p,T as D,e as E,E as V,l as O}from"./index-1d9bac3f.js";const m=e=>JSON.parse(JSON.stringify(e)),v=N({props:{modelValue:{type:Array,default:()=>[],required:!0},columns:{type:Array,required:!0},model:{type:Object,default:()=>Object.assign({})},rules:{type:Object,default:()=>null},tableProps:{type:Object,default:()=>({stripe:!0,border:!0,size:"small","empty-text":"没有数据"})},addTitle:{type:String,default:()=>"+ 添加"}},emits:["update:modelValue"],setup(e,o){const t=k({data:e.modelValue?JSON.parse(JSON.stringify(e.modelValue)):[],editing:!1,editItem:{},editIndex:void 0,isNew:!1,sublistForm:null}),i=h();T(()=>{t.sublistForm=i.value});const n=()=>{t.data=e.modelValue?JSON.parse(JSON.stringify(e.modelValue)):[],t.editing=!1,t.editItem=void 0,t.editIndex=void 0,t.isNew=!1};$(()=>e.modelValue,()=>{n()});const l=()=>{t.data.push(m(e.model)),t.editIndex=t.data.length-1,t.editing=!0,t.editItem=m(m(e.model)),t.isNew=!0},u=q(t,o);return{sublistState:t,addData:l,form:i,actionColumnProps:u}},render(){const e=this.$props,o=this.sublistState,t=m(e.tableProps),i={size:"small",inline:!0,inlineMessage:!0,showMessage:!0,rules:e.rules,model:o.editItem};return r("div",{class:"sublist-div"},[o.data&&r(w,x({ref:"form"},i),{default:()=>[r(F,x(t,{data:o.data}),{default:()=>[e.columns.map(n=>{const l=C(n);if(o.editing&&l.type!=="index"){const u=l.editComponent||M();return r(y,l,{default:s=>{const b=s.row[s.column.property],S=()=>s.column.formatter?s.column.formatter(s.row,s.column,b,s.$index):b;return o.editIndex===s.$index?u(s,o):S()}})}else return r(y,l,null)}),r(y,this.actionColumnProps,this.actionColumnProps.vSlots)]})]}),!o.editing&&r("div",{class:"sublist-add",onClick:()=>this.addData()},[e.addTitle])])}}),q=(e,o)=>{function t(a){e.editIndex=a.$index,e.editing=!0,e.editItem=m(a.row)}function i(a){var s;(s=e==null?void 0:e.data)==null||s.splice(a,1),o.emit("update:modelValue",e.data)}function n(){e.sublistForm.validate(a=>{if(a)typeof(e==null?void 0:e.editIndex)=="number"&&e.data.splice(e==null?void 0:e.editIndex,1,m(C(e.editItem))),e.editIndex=void 0,e.editItem=void 0,e.editing=!1,o.emit("update:modelValue",e.data);else return!1})}function l(){e.isNew&&e.data.splice(e.data.length-1,1),e.editItem=void 0,e.editing=!1,e.editIndex=void 0}function u(){return e.editing?"readonly":""}return{align:"center",label:"操作",vSlots:{default:a=>r("div",{class:"sublist-actions"},[e.editing&&a.$index===e.editIndex?r("div",null,[r("span",{class:"sublist-confirm sublist-btn",onClick:()=>n()},[d("确认")]),r("span",{class:"sublist-split"},[d("|")]),r("span",{class:"sublist-cancel sublist-btn",onClick:()=>l()},[d("取消")])]):r("div",null,[r("span",{class:`${u()} sublist-edit sublist-btn`,onClick:()=>{e.editing||t(a)}},[d("编辑")]),r("span",{class:`${u()} `},[d("|")]),r("span",{class:`${u()} sublist-delete sublist-btn`,onClick:()=>{e.editing||i(a.$index)}},[d("删除")])])])}}};function M(){return function(e,o){return r(g,{size:"small",class:"sublist-form-item",label:e.column.name,prop:e.column.property},{default:()=>[r(c,{label:e.column.label,size:"small",modelValue:o.editItem[e.column.property],"onUpdate:modelValue":t=>o.editItem[e.column.property]=t},null)]})}}const z={id:{component:c,placeholder:"节点ID",vSlots:{prepend:()=>r("div",null,[d("节点ID")])},setValue(e,o,t){const i=t,n=t||" ",l=p.getShape();p.updateProperties(l,{[o]:i?n.trim():n})}},name:{component:c,placeholder:"节点名称",vSlots:{prepend:()=>r("div",null,[d("节点名称")])}}},L={name:"基础信息",icon:"el-icon-info",properties:{...z}},_={name:"元素文档",icon:"el-icon-document",properties:{"documentation.text":{component:c,type:"textarea",getValue:e=>{var o,t;return((t=(o=e.documentation)==null?void 0:o[0])==null?void 0:t.text)??""},setValue(e,o,t){p.createElement("bpmn:Documentation","documentation",{text:t},!0)}}}},B=[{label:"开始",value:"start"},{label:"结束",value:"end"}],I=[{label:"java类",value:"class"},{label:"调用表达式",value:"expression"},{label:"注入表达式",value:"delegateExpression"}];function P(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!O(e)}const f=Object.keys(D),A=function(e){const o=e.eventOptions||B;return{name:e.name||"监听器",icon:e.icon||"el-icon-bell",properties:{"extensionElements.listeners":{component:v,columns:[{type:"index",label:"序号",align:"center"},{prop:"event",label:"事件",align:"center",formatter:(t,i)=>o.filter(n=>n.value===t[i.property])[0].label,editComponent:function(t,i){let n;return r(g,{size:"small",class:"sublist-form-item",label:t.column.name,prop:t.column.property},{default:()=>[r(E,{modelValue:i.editItem.event,"onUpdate:modelValue":l=>i.editItem.event=l},P(n=o.map(l=>r(V,{key:l.value,label:l.label,value:l.value},null)))?n:{default:()=>[n]})]})}},{prop:"type",label:"执行类型",align:"center",formatter:(t,i)=>I.filter(n=>n.value===t[i.property])[0].label,editComponent:function(t,i){let n;return r(g,{size:"small",class:"sublist-form-item",label:t.column.name,prop:t.column.property},{default:()=>[r(E,{modelValue:i.editItem.type,"onUpdate:modelValue":l=>i.editItem.type=l},P(n=I.map(l=>r(V,{key:l.value,label:l.label,value:l.value},null)))?n:{default:()=>[n]})]})}},{prop:"content",label:"执行内容",align:"center"}],rules:{event:[{required:!0,message:"事件不能为空"}],type:[{required:!0,message:"类型不能为空"}],content:[{required:!0,message:"执行内容不能为空"}]},getValue:t=>{var l,u;const i=f!=null&&f.includes(t.$type)?"activiti:TaskListener":"activiti:ExecutionListener",n=(u=(l=t==null?void 0:t.extensionElements)==null?void 0:l.values)==null?void 0:u.filter(a=>a.$type===i);return n?n==null?void 0:n.map(a=>{const s=a.expression?"expression":a.delegateExpression?"delegateExpression":"class";return{event:a.event,type:s,content:a[s]}}):[]},setValue(t,i,n){const l=p,u=l.getModeler().get("moddle"),a=f.includes(t.$type)?"activiti:TaskListener":"activiti:ExecutionListener";l.updateExtensionElements(a,n.map(s=>u.create(a,{event:s.event,[s.type]:s.content})))}}}}},G={name:"扩展属性",icon:"el-icon-document-add",properties:{"extensionElements.properties":{component:v,columns:[{type:"index",label:"序号",align:"center"},{prop:"name",label:"属性名",align:"center"},{prop:"value",label:"属性值",align:"center"}],rules:{name:[{required:!0,message:"属性名不能为空"}],value:[{required:!0,message:"属性值不能为空"}]},getValue:e=>{var t,i,n;const o=(n=(i=(t=e==null?void 0:e.extensionElements)==null?void 0:t.values)==null?void 0:i.filter(l=>l.$type==="activiti:Properties")[0])==null?void 0:n.values;return o?o.map(l=>({name:l.name,value:l.value})):[]},setValue(e,o,t){const i=p,n=i.getModeler().get("moddle"),l=n.create("activiti:Properties",{values:t.map(u=>n.create("activiti:Property",{name:u.name,value:u.value}))});i.updateExtensionElements("activiti:Properties",l)}}}},R={name:"表单信息",icon:"el-icon-edit",properties:{formKey:{component:c,placeholder:"表单key",vSlots:{prepend:()=>r("div",null,[d("表单key")])}},"extensionElements.formProperty":{component:v,columns:[{prop:"id",label:"编码",align:"center"},{prop:"type",label:"类型",align:"center"},{prop:"name",label:"名称",align:"center"}],rules:{id:[{required:!0,message:"编码不能为空"}],type:[{required:!0,message:"类型不能为空"}],name:[{required:!0,message:"名称不能为空"}]},getValue:e=>{var t,i;const o=(i=(t=e==null?void 0:e.extensionElements)==null?void 0:t.values)==null?void 0:i.filter(n=>n.$type==="activiti:FormProperty");return o?o.map(n=>{var l;return{id:n==null?void 0:n.id,type:n.type,name:(l=n==null?void 0:n.$attrs)==null?void 0:l.name}}):[]},setValue(e,o,t){const i=p,n=i.getModeler().get("moddle"),l=t.map(u=>n.create("activiti:FormProperty",{id:u.id,name:u.name,type:u.type}));i.updateExtensionElements("activiti:FormProperty",l)}}}};export{L as C,_ as D,G as E,R as F,A as g};
